generator client {
  provider = "prisma-client"
  output   = "../generated/prisma/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                        Int       @id @default(autoincrement())
  email                     String    @unique
  password_hash             String
  first_name                String
  last_name                 String
  email_verified            Boolean   @default(false)
  verification_token        String?
  verification_expires_at   DateTime?
  created_at                DateTime  @default(now())
  updated_at                DateTime  @updatedAt
  password_reset_expires_at DateTime?
  password_reset_token      String?
  profile_picture           String? // Store as base64 encoded string (data:image/jpeg;base64,...)
  forms                     Form[]

  @@map("users")
}

model Form {
  id           Int              @id @default(autoincrement())
  user_id      Int
  title        String
  description  String?
  slug         String           @unique
  puck_content Json
  is_published Boolean          @default(false)
  settings     Json?            @default("{}")
  deleted_at   DateTime?
  created_at   DateTime         @default(now())
  updated_at   DateTime         @updatedAt
  submissions  FormSubmission[]
  user         User             @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([slug])
  @@index([is_published])
  @@map("forms")
}

model FormSubmission {
  id              Int      @id @default(autoincrement())
  form_id         Int
  email           String
  submission_data Json
  ip_address      String?
  submitted_at    DateTime @default(now())
  form            Form     @relation(fields: [form_id], references: [id], onDelete: Cascade)

  @@index([form_id])
  @@index([email])
  @@index([submitted_at])
  @@map("form_submissions")
}
